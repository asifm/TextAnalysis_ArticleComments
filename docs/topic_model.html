<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Asif Mehedi | Darden School">
<meta name="dcterms.date" content="2024-05-14">

<title>Affirmative Action in College Admission: Analyzing Responses to Supreme Court Decision</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>



</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Affirmative Action in College Admission: Analyzing Responses to Supreme Court Decision</h1>
            <p class="subtitle lead">Topic Modeling of NYT and WSJ Online Readers’ Comments</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Asif Mehedi | Darden School </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 14, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about-this-document" id="toc-about-this-document" class="nav-link active" data-scroll-target="#about-this-document">About this document</a>
  <ul class="collapse">
  <li><a href="#purpose" id="toc-purpose" class="nav-link" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#quarto-notebook" id="toc-quarto-notebook" class="nav-link" data-scroll-target="#quarto-notebook">Quarto Notebook</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#loading-r-packages" id="toc-loading-r-packages" class="nav-link" data-scroll-target="#loading-r-packages">Loading R packages</a></li>
  <li><a href="#getting-data" id="toc-getting-data" class="nav-link" data-scroll-target="#getting-data">Getting data</a></li>
  </ul></li>
  <li><a href="#pre-processing-data" id="toc-pre-processing-data" class="nav-link" data-scroll-target="#pre-processing-data">Pre-processing data</a></li>
  <li><a href="#document-term-matrix" id="toc-document-term-matrix" class="nav-link" data-scroll-target="#document-term-matrix">Document-term matrix</a></li>
  <li><a href="#topic-modeling" id="toc-topic-modeling" class="nav-link" data-scroll-target="#topic-modeling">Topic modeling</a></li>
  <li><a href="#evaluating-topics" id="toc-evaluating-topics" class="nav-link" data-scroll-target="#evaluating-topics">Evaluating topics</a>
  <ul class="collapse">
  <li><a href="#topic-model-k-2" id="toc-topic-model-k-2" class="nav-link" data-scroll-target="#topic-model-k-2">Topic model: k = 2</a></li>
  <li><a href="#topic-model-k-3" id="toc-topic-model-k-3" class="nav-link" data-scroll-target="#topic-model-k-3">Topic model: k = 3</a></li>
  <li><a href="#topic-model-k-4" id="toc-topic-model-k-4" class="nav-link" data-scroll-target="#topic-model-k-4">Topic model: k = 4</a></li>
  <li><a href="#topic-model-k-5" id="toc-topic-model-k-5" class="nav-link" data-scroll-target="#topic-model-k-5">Topic model: k = 5</a></li>
  <li><a href="#topic-model-k-6" id="toc-topic-model-k-6" class="nav-link" data-scroll-target="#topic-model-k-6">Topic model: k = 6</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<section id="about-this-document" class="level1">
<h1>About this document</h1>
<section id="purpose" class="level2">
<h2 class="anchored" data-anchor-id="purpose">Purpose</h2>
<p>This notebook provides a step-by-step guide for performing topic modeling (TM). TM is an exploratory and inductive technique that often requires experimenting with various algorithms and parameters to achieve satisfactory results. In this example, we use the Latent Dirichlet Allocation (LDA) algorithm, a widely used TM method. This document serves as a starting point for further experimentation, exploration, and refinement.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
  input([Input: text data]) --&gt; A(Pre-process text data) 
  A --&gt; B(Create document-term matrix) --&gt; C(Decide on model parameters) 
  C --&gt; D(Generate topic model) 
  D --&gt; output([Output: N lists of terms, each list representing a topic])
  output -.-&gt; E(Evaluate coherence of topics) -.-&gt; C
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="quarto-notebook" class="level2">
<h2 class="anchored" data-anchor-id="quarto-notebook">Quarto Notebook</h2>
<p>This was written as a <a href="https://quarto.org/">Quarto notebook</a>, which provides a rich authoring and publishing environment. Importantly, the notebook format allows the interleaving of prose commentary and code outputs (such as tables or plots) between blocks of code.</p>
<p>To view, change or execute any code, please open the source notebook (a .qmd file in the repository) in <a href="https://posit.co/download/rstudio-desktop/">R Studio</a>. Please consult the <a href="https://quarto.org/">Quarto website</a> for instructions on how to set up your execution environment.</p>
<p>Alternatively, you can use the R script file that contains the same code and is available in the repository.</p>
</section>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<section id="loading-r-packages" class="level2">
<h2 class="anchored" data-anchor-id="loading-r-packages">Loading R packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tm)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(topicmodels)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(slam)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(topicdoc)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(stopwords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="getting-data" class="level2">
<h2 class="anchored" data-anchor-id="getting-data">Getting data</h2>
<p>We load the data from a CSV file that contains the text of the posts. The data was collected from the online comments section of two news websites, The New York Times (NYT) and The Wall Street Journal (WSJ). The data was collected in 2023, following the Supreme Court’s decision on affirmative action in college admissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>posts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/posts.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid ambiguity, I use <code>post</code> as a general term to mean top-level comments as well as nested replies. The term <code>comment</code> means only top-level comments.</p>
</div>
</div>
<p>The CSV file was earlier prepared from two Excel files, one for each news website, as follows:</p>
<ol type="1">
<li>The Excel files were manually cleaned to remove duplicate, malformed and unrelated data.</li>
<li>The two sets of cleaned data were further processed in R to standardize their column names, remove unnecessary columns and create a few new ones.</li>
<li>All data were then merged into a single CSV file, <code>posts.csv</code>, containing the following columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">glimpse</span>(posts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 44,473
Columns: 9
$ post_text     &lt;chr&gt; "&gt; Is that fair? -- -- No; but that's not an argument fo…
$ post_id       &lt;chr&gt; "wsj1", "wsj2", "wsj3", "wsj4", "wsj5", "wsj6", "wsj7", …
$ post_type     &lt;chr&gt; "reply", "comment", "comment", "comment", "comment", "co…
$ post_length   &lt;dbl&gt; 100, 1443, 1240, 1193, 1191, 894, 732, 701, 640, 558, 54…
$ post_date     &lt;date&gt; 2023-07-06, 2023-06-30, 2023-06-29, 2023-06-29, 2023-07…
$ upvotes       &lt;dbl&gt; 2, 0, 0, 0, 1, 2, 9, 4, 5, 0, 0, 0, 6, 4, 0, 2, 2, 1, 1,…
$ reply_count   &lt;dbl&gt; 0, 3, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 3,…
$ article_title &lt;chr&gt; "Opinion: Justice Jackson’s Incredible Statistic", "Scho…
$ article_url   &lt;chr&gt; "https://www.wsj.com/articles/justice-jacksons-incredibl…</code></pre>
</div>
</div>
<details>
<summary>
The code that generated <code>posts.csv</code> from the original Excel files.
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(readxl)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>nyt <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"Data/CommentsNYT.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"cleaned"</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>wsj <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"Data/CommentsWSJ.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"cleaned"</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a>nyt_posts <span class="ot">&lt;-</span> nyt <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">rename</span>(</span>
<span id="cb5-9"><a href="#cb5-9"></a>    <span class="at">post_text =</span> commentBody, <span class="at">post_type =</span> commentType,</span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="at">article_url =</span> address, <span class="at">article_title =</span> title,</span>
<span id="cb5-11"><a href="#cb5-11"></a>    <span class="at">upvotes =</span> recommendations, <span class="at">reply_count =</span> replyCount,</span>
<span id="cb5-12"><a href="#cb5-12"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="at">post_id =</span> <span class="fu">paste0</span>(<span class="st">"nyt"</span>, <span class="fu">row_number</span>()),</span>
<span id="cb5-15"><a href="#cb5-15"></a>    <span class="at">post_type =</span> <span class="fu">ifelse</span>(post_type <span class="sc">==</span> <span class="st">"userReply"</span>, <span class="st">"reply"</span>, post_type),</span>
<span id="cb5-16"><a href="#cb5-16"></a>    <span class="at">post_date =</span> <span class="fu">as_date</span>(createDate),</span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="at">publication =</span> <span class="st">"NYT"</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>  <span class="fu">select</span>(</span>
<span id="cb5-20"><a href="#cb5-20"></a>    post_text, post_id, post_type, post_length, post_date,</span>
<span id="cb5-21"><a href="#cb5-21"></a>    upvotes, reply_count, article_title, article_url</span>
<span id="cb5-22"><a href="#cb5-22"></a>  )</span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a>wsj_posts <span class="ot">&lt;-</span> wsj <span class="sc">|&gt;</span></span>
<span id="cb5-25"><a href="#cb5-25"></a>  <span class="fu">rename</span>(</span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span class="at">post_text =</span> content, <span class="at">post_type =</span> type,</span>
<span id="cb5-27"><a href="#cb5-27"></a>    <span class="at">article_url =</span> address, <span class="at">article_title =</span> title,</span>
<span id="cb5-28"><a href="#cb5-28"></a>    <span class="at">upvotes =</span> rank.ranks_up, <span class="at">reply_count =</span> replies_count</span>
<span id="cb5-29"><a href="#cb5-29"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-30"><a href="#cb5-30"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-31"><a href="#cb5-31"></a>    <span class="at">post_id =</span> <span class="fu">paste0</span>(<span class="st">"wsj"</span>, <span class="fu">row_number</span>()),</span>
<span id="cb5-32"><a href="#cb5-32"></a>    <span class="at">post_date =</span> <span class="fu">as_date</span>(written_at),</span>
<span id="cb5-33"><a href="#cb5-33"></a>    <span class="at">publication =</span> <span class="st">"WSJ"</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-35"><a href="#cb5-35"></a>  <span class="fu">select</span>(</span>
<span id="cb5-36"><a href="#cb5-36"></a>    post_text, post_id, post_type, post_length, post_date,</span>
<span id="cb5-37"><a href="#cb5-37"></a>    upvotes, reply_count, article_title, article_url</span>
<span id="cb5-38"><a href="#cb5-38"></a>  )</span>
<span id="cb5-39"><a href="#cb5-39"></a></span>
<span id="cb5-40"><a href="#cb5-40"></a>posts <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(wsj_posts, nyt_posts)</span>
<span id="cb5-41"><a href="#cb5-41"></a></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="fu">write_csv</span>(posts, <span class="st">"Data/posts.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p>Below is a random sample of five rows from the <code>posts</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">slice_sample</span>(posts, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["post_text"],"name":[1],"type":["chr"],"align":["left"]},{"label":["post_id"],"name":[2],"type":["chr"],"align":["left"]},{"label":["post_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["post_length"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["post_date"],"name":[5],"type":["date"],"align":["right"]},{"label":["upvotes"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["reply_count"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["article_title"],"name":[8],"type":["chr"],"align":["left"]},{"label":["article_url"],"name":[9],"type":["chr"],"align":["left"]}],"data":[{"1":"I don't see this as a debate to win, it was like arguing with a intellectually limited child. There is nothing to win or lose. You have your fairy tales of white persecution that you want to believe, and if that makes your sad life better, then feel free to lash out at \"others\" who have taken your prosperity. My mistake was engaging with someone who is obviously as mentally challenged as you are. I wish you the best.","2":"wsj4419","3":"reply","4":"420","5":"2023-07-05","6":"0","7":"1","8":"Opinion: The Supreme Court Declares Independence","9":"https://www.wsj.com/articles/the-supreme-court-declares-independence-303-student-loan-racial-preferences-roberts-71859d37"},{"1":"Feels good to agree 100% with a Journal editorial. It's been awhile.","2":"wsj18782","3":"comment","4":"68","5":"2023-06-30","6":"7","7":"0","8":"Opinion: A Landmark for Racial Equality at the Supreme Court","9":"https://www.wsj.com/articles/harvard-unc-students-for-fair-admissions-supreme-court-affirmative-action-john-roberts-clarence-thomas-racial-preferences-f8c998f6"},{"1":"An American civil rights hero","2":"wsj21857","3":"comment","4":"29","5":"2023-07-06","6":"6","7":"0","8":"Opinion: Edward Blum, the Man Who Killed Affirmative Action","9":"https://www.wsj.com/articles/the-man-who-killed-affirmative-action-ed-blum-sffa-harvard-court-race-36143530"},{"1":"@Naturalized Citizen Not every kid has educated or even engaged parents to help them. ALL of our public schools should be very well funded and preparation for college or trade for every American kid. The US should have the best public schools in the world","2":"nyt8716","3":"reply","4":"255","5":"2023-06-29","6":"3","7":"0","8":"Ruling May Mean a Sharp Drop in Black and Latino StudentsBans on race-conscious college admissions at the state level had quick effects.By Stephanie Saul","9":"https://www.nytimes.com/2023/06/29/us/politics/affirmative-action-college-students-black-latino.html"},{"1":"Asian Americans were at the forefront of campaigning against Affirmative Action, but a possible unintended consequence of this in the current scenario will be that since universities will no longer have to consider diversity, it may actually hurt the Asian American students' chances of acceptance to competitive programs more than any other racial ethnic group in the country. In a world where SAT or ACT is no longer the primary deciding factor, it opens the door for universities to pretty much choose whoever they think is the best fit for their needs, this will include giving equal consideration to international students from emerging economies in Eastern Europe, South America, Africa, and Asia who now have the purchase power to pay out of state tuition that many revenue starved colleges desperately need, over prioritizing race and diversity in admission decisions.","2":"wsj1212","3":"comment","4":"876","5":"2023-06-29","6":"0","7":"0","8":"Can Colleges Be Racially Diverse Without Affirmative Action? Experience Suggests No","9":"https://www.wsj.com/articles/supreme-court-affirmative-action-college-admissions-e3de89d8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="pre-processing-data" class="level1">
<h1>Pre-processing data</h1>
<p>For topic modeling, the relevant columns of the data frame are: - <code>post_text</code>: the text of the post - <code>post_id</code>: unique identifier for each post</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Rename relevant columns according to `tm` package requirements</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>textdata <span class="ot">&lt;-</span> posts <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">rename</span>(<span class="at">doc_id =</span> post_id, <span class="at">text =</span> post_text) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">select</span>(doc_id, text) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The text data is first transformed through a series of steps to remove various types of noise:</p>
<ol type="1">
<li>Convert to lower case</li>
<li>Remove stopwords (common words that do not carry much meaning)</li>
<li>Remove punctuation</li>
<li>Remove numbers</li>
<li>Stem words (convert related words to a common base form)</li>
<li>Strip whitespace</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>en_stopwords <span class="ot">&lt;-</span> stopwords<span class="sc">::</span><span class="fu">stopwords</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="at">language =</span> <span class="st">"en"</span>, <span class="at">source =</span> <span class="st">"snowball"</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>)</span>
<span id="cb8-4"><a href="#cb8-4"></a>corpus <span class="ot">&lt;-</span> tm<span class="sc">::</span><span class="fu">Corpus</span>(<span class="fu">DataframeSource</span>(textdata)) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="fu">tm_map</span>(<span class="fu">content_transformer</span>(tolower)) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="fu">tm_map</span>(removeWords, en_stopwords) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="fu">tm_map</span>(removePunctuation, <span class="at">preserve_intra_word_dashes =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="fu">tm_map</span>(removeNumbers) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="fu">tm_map</span>(stemDocument, <span class="at">language =</span> <span class="st">"en"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="fu">tm_map</span>(stripWhitespace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="document-term-matrix" class="level1">
<h1>Document-term matrix</h1>
<p>Topic modeling requires, as its input, a <a href="https://en.wikipedia.org/wiki/Document-term_matrix">document-term matrix (DTM)</a>, where each row represents a document (a post in our case) and each column represents a term (a word). The value of each cell in the matrix is the frequency of the term in the corresponding document.</p>
<p>We now create a DTM from the pre-processed text data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>min_doc <span class="ot">&lt;-</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>dtm <span class="ot">&lt;-</span> tm<span class="sc">::</span><span class="fu">DocumentTermMatrix</span>(corpus,</span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">bounds =</span> <span class="fu">list</span>(<span class="at">global =</span> <span class="fu">c</span>(min_doc, <span class="cn">Inf</span>)))</span>
<span id="cb10-3"><a href="#cb10-3"></a>)</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># Vocabulary pruning may create empty rows in the dtm.</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co"># Such rows need to be removed before running LDA.</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>idx <span class="ot">&lt;-</span> slam<span class="sc">::</span><span class="fu">row_sums</span>(dtm) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>dtm <span class="ot">&lt;-</span> dtm[idx, ]</span>
<span id="cb10-9"><a href="#cb10-9"></a>textdata <span class="ot">&lt;-</span> textdata[idx, ]</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co"># Save for later use</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="fu">save</span>(dtm, textdata, <span class="at">file =</span> <span class="st">"r_objects/dtm.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While creating the DTM, we removed terms that occur in fewer than 10 documents. This is done to reduce the size of the matrix and to remove terms that are too rare to be useful in identifying topics.</p>
<p>The DTM is a sparse matrix, which means that most of the cells are zero. We can inspect the DTM and see its structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">load</span>(<span class="st">"r_objects/dtm.RData"</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>tm<span class="sc">::</span><span class="fu">inspect</span>(dtm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;&lt;DocumentTermMatrix (documents: 44323, terms: 5984)&gt;&gt;
Non-/sparse entries: 1003305/264225527
Sparsity           : 100%
Maximal term length: 16
Weighting          : term frequency (tf)
Sample             :
        Terms
Docs     action admiss affirm black colleg get one peopl school student
  nyt115      3      0      3     0      3   1   0     2      5       8
  nyt116      1      0      1     0      2   1   0     0      1       3
  nyt125      0      0      0     0      3   0   3     0      5       2
  nyt147      1      0      1     1      1   1   0     0      0       0
  nyt261      0      1      0     0      4   1   3     0      5       0
  nyt292      1      0      1     0      4   4   0     0      4       6
  nyt404      0      0      0     0      1   0   2     0      5       0
  wsj119      2      0      2     3      0   0   0     4      0       0
  wsj195      0      0      0     0      0   1   2     2      0       0
  wsj252      0      0      0     3      0   1   4     0      0       0</code></pre>
</div>
</div>
<p>We can find the most frequently occurring terms in the DTM for each news website.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Split the dtm into two parts</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>dtm_wsj <span class="ot">&lt;-</span> dtm[<span class="fu">grepl</span>(<span class="st">"^wsj"</span>, dtm<span class="sc">$</span>dimnames<span class="sc">$</span>Docs), ]</span>
<span id="cb13-3"><a href="#cb13-3"></a>dtm_nyt <span class="ot">&lt;-</span> dtm[<span class="fu">grepl</span>(<span class="st">"^nyt"</span>, dtm<span class="sc">$</span>dimnames<span class="sc">$</span>Docs), ]</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co"># Calculate term frequencies for wsj</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>term_freq_wsj <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">colSums</span>(<span class="fu">as.matrix</span>(dtm_wsj))</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co"># Sort term frequencies in descending order for wsj</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>sorted_term_freq_wsj <span class="ot">&lt;-</span> <span class="fu">sort</span>(term_freq_wsj, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co"># Find the most occurring 20 terms in wsj</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>top_terms_wsj <span class="ot">&lt;-</span> sorted_term_freq_wsj[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb13-13"><a href="#cb13-13"></a></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co"># Calculate term frequencies for nyt</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>term_freq_nyt <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">colSums</span>(<span class="fu">as.matrix</span>(dtm_nyt))</span>
<span id="cb13-16"><a href="#cb13-16"></a></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co"># Sort term frequencies in descending order for nyt</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>sorted_term_freq_nyt <span class="ot">&lt;-</span> <span class="fu">sort</span>(term_freq_nyt, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-19"><a href="#cb13-19"></a></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co"># Find the most occurring 20 terms in nyt</span></span>
<span id="cb13-21"><a href="#cb13-21"></a>top_terms_nyt <span class="ot">&lt;-</span> sorted_term_freq_nyt[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>New York Times:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">print</span>(top_terms_nyt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> school student  colleg  admiss   peopl  action  affirm   court    educ     get 
   7572    7254    6352    4929    4351    4255    4118    4074    3997    3923 
    one     can univers    race    like   white    just    mani  legaci    make 
   3729    3540    3390    3283    3156    3113    2996    2978    2791    2735 </code></pre>
</div>
</div>
<p>Wall Street Journal:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">print</span>(top_terms_wsj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   school     black     peopl   student       one      race       get       can 
     4644      4080      3372      3308      3179      3122      2920      2877 
    white    colleg    action    affirm      like      just     court    divers 
     2824      2810      2757      2666      2543      2539      2528      2375 
   admiss discrimin     think      educ 
     2344      2278      2201      2076 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The terms are <em>stemmed</em>, so they are usually not in their original form.</p>
</div>
</div>
</section>
<section id="topic-modeling" class="level1">
<h1>Topic modeling</h1>
<p>Now we are ready to run the LDA algorithm to generate topics from the DTM.</p>
<p>The LDA function, which comes from the <code>topicmodels</code> package, has <a href="https://rdrr.io/cran/topicmodels/man/tmcontrol-class.html">a number of hyperparameters</a> that can be tuned. Here we use the default values for most of them.</p>
<p>Since this algorithm is stochastic, meaning that it may produce different results each time it is run, we set a seed value to ensure reproducibility.</p>
<p>The key parameter is <code>k</code>, the number of topics. We create multiple models by looping over different values of <code>k</code>, saving each model for later inspection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># Number of iterations for the LDA algorithm</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb18-7"><a href="#cb18-7"></a>    <span class="co"># Create the LDA model</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>    lda <span class="ot">&lt;-</span> topicmodels<span class="sc">::</span><span class="fu">LDA</span>(dtm,</span>
<span id="cb18-9"><a href="#cb18-9"></a>        <span class="at">k =</span> k, <span class="at">method =</span> <span class="st">"Gibbs"</span>,</span>
<span id="cb18-10"><a href="#cb18-10"></a>        <span class="at">control =</span> <span class="fu">list</span>(<span class="at">iter =</span> iter, <span class="at">verbose =</span> iter <span class="sc">/</span> <span class="dv">10</span>)</span>
<span id="cb18-11"><a href="#cb18-11"></a>    )</span>
<span id="cb18-12"><a href="#cb18-12"></a></span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="co"># Save the model</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>    <span class="fu">saveRDS</span>(lda, <span class="fu">paste0</span>(<span class="st">"R_objects/lda_"</span>, k, <span class="st">".rds"</span>))</span>
<span id="cb18-15"><a href="#cb18-15"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluating-topics" class="level1 page-columns page-full">
<h1>Evaluating topics</h1>
<p>We can now inspect the topics generated by the models for each value of <code>k</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The topics are represented as lists of terms. Within a topic, the terms are ordered by their relevance to that topic.</p>
</div>
</div>
<p>In addition to showing the top terms for each topic, we can also use the <code>topicdoc</code> package to get a diagnostic summary of the topics. The summary provides a range of metrics to evaluate the quality of the generated topics.</p>
<p>From the package’s <a href="https://cran.r-project.org/web/packages/topicdoc/vignettes/basic_usage.html">documentation</a>:</p>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 82%">
</colgroup>
<thead>
<tr class="header">
<th>Metric</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>topic_size</td>
<td>Total (weighted) number of tokens per topic</td>
</tr>
<tr class="even">
<td>mean_token_length</td>
<td>Average number of characters for the top tokens per topic</td>
</tr>
<tr class="odd">
<td>dist_from_corpus</td>
<td>Distance of a topic’s token distribution from the overall corpus token distribution</td>
</tr>
<tr class="even">
<td>tf_df_dist</td>
<td>Distance between a topic’s token and document distributions</td>
</tr>
<tr class="odd">
<td>doc_prominence</td>
<td>Number of unique documents where a topic appears</td>
</tr>
<tr class="even">
<td>topic_coherence</td>
<td>Measure of how often the top tokens in each topic appear together in the same document</td>
</tr>
<tr class="odd">
<td>topic_exclusivity</td>
<td>Measure of how unique the top tokens in each topic are compared to the other topics</td>
</tr>
</tbody>
</table>
<p>The metrics are described in detail in <a href="https://mimno.infosci.cornell.edu/papers/2014_book_chapter_care_and_feeding.pdf">this book chapter</a>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<section id="topic-model-k-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="topic-model-k-2">Topic model: k = 2</h2>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>lda2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"R_objects/lda_2.rds"</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a>top_terms2 <span class="ot">&lt;-</span> <span class="fu">terms</span>(lda2, <span class="dv">15</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="fu">print</span>(top_terms2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Topic 1     Topic 2  
 [1,] "action"    "school" 
 [2,] "affirm"    "student"
 [3,] "peopl"     "colleg" 
 [4,] "court"     "admiss" 
 [5,] "race"      "get"    
 [6,] "black"     "educ"   
 [7,] "right"     "univers"
 [8,] "discrimin" "divers" 
 [9,] "one"       "mani"   
[10,] "american"  "can"    
[11,] "just"      "need"   
[12,] "decis"     "work"   
[13,] "justic"    "legaci" 
[14,] "now"       "white"  
[15,] "law"       "year"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>topicdoc<span class="sc">::</span><span class="fu">topic_diagnostics</span>(<span class="at">topic_model =</span> lda2, <span class="at">dtm_data =</span> dtm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["topic_num"],"name":[1],"type":["int"],"align":["right"]},{"label":["topic_size"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean_token_length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["dist_from_corpus"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["tf_df_dist"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["doc_prominence"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["topic_coherence"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["topic_exclusivity"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"3530.129","3":"5.6","4":"0.4605488","5":"24.67541","6":"44321","7":"-129.2440","8":"8.460829"},{"1":"2","2":"2453.871","3":"5.2","4":"0.4481033","5":"31.79457","6":"44321","7":"-112.4698","8":"9.758207"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="topic-model-k-3" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="topic-model-k-3">Topic model: k = 3</h2>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>lda3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"R_objects/lda_3.rds"</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a>top_terms3 <span class="ot">&lt;-</span> <span class="fu">terms</span>(lda3, <span class="dv">15</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">print</span>(top_terms3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Topic 1   Topic 2     Topic 3    
 [1,] "school"  "peopl"     "court"    
 [2,] "student" "action"    "right"    
 [3,] "colleg"  "black"     "decis"    
 [4,] "admiss"  "affirm"    "justic"   
 [5,] "get"     "race"      "law"      
 [6,] "educ"    "white"     "suprem"   
 [7,] "univers" "divers"    "rule"     
 [8,] "work"    "discrimin" "one"      
 [9,] "legaci"  "american"  "state"    
[10,] "mani"    "just"      "know"     
[11,] "kid"     "way"       "case"     
[12,] "harvard" "base"      "constitut"
[13,] "need"    "one"       "say"      
[14,] "year"    "asian"     "major"    
[15,] "can"     "minor"     "time"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>topicdoc<span class="sc">::</span><span class="fu">topic_diagnostics</span>(<span class="at">topic_model =</span> lda3, <span class="at">dtm_data =</span> dtm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["topic_num"],"name":[1],"type":["int"],"align":["right"]},{"label":["topic_size"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean_token_length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["dist_from_corpus"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["tf_df_dist"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["doc_prominence"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["topic_coherence"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["topic_exclusivity"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1689.224","3":"5.3","4":"0.5526534","5":"31.25872","6":"43712","7":"-118.3548","8":"9.811130"},{"1":"2","2":"1582.715","3":"5.8","4":"0.5425784","5":"24.78701","6":"44140","7":"-123.1761","8":"9.855932"},{"1":"3","2":"2712.061","3":"4.6","4":"0.5589820","5":"16.36112","6":"43713","7":"-145.6693","8":"9.168930"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="topic-model-k-4" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="topic-model-k-4">Topic model: k = 4</h2>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>lda4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"R_objects/lda_4.rds"</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a>top_terms4 <span class="ot">&lt;-</span> <span class="fu">terms</span>(lda4, <span class="dv">15</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="fu">print</span>(top_terms4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Topic 1 Topic 2     Topic 3     Topic 4  
 [1,] "just"  "action"    "court"     "school" 
 [2,] "like"  "black"     "right"     "student"
 [3,] "one"   "affirm"    "decis"     "colleg" 
 [4,] "peopl" "race"      "justic"    "admiss" 
 [5,] "can"   "white"     "law"       "educ"   
 [6,] "think" "divers"    "suprem"    "univers"
 [7,] "work"  "discrimin" "rule"      "legaci" 
 [8,] "want"  "american"  "case"      "get"    
 [9,] "make"  "base"      "state"     "kid"    
[10,] "know"  "peopl"     "major"     "harvard"
[11,] "year"  "asian"     "constitut" "mani"   
[12,] "get"   "minor"     "fact"      "high"   
[13,] "time"  "equal"     "thoma"     "class"  
[14,] "good"  "racial"    "democrat"  "public" 
[15,] "’s"    "group"     "read"      "admit"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>topicdoc<span class="sc">::</span><span class="fu">topic_diagnostics</span>(<span class="at">topic_model =</span> lda4, <span class="at">dtm_data =</span> dtm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["topic_num"],"name":[1],"type":["int"],"align":["right"]},{"label":["topic_size"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean_token_length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["dist_from_corpus"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["tf_df_dist"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["doc_prominence"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["topic_coherence"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["topic_exclusivity"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1456.165","3":"4.0","4":"0.6167093","5":"14.49313","6":"39799","7":"-135.0707","8":"9.414085"},{"1":"2","2":"1221.065","3":"5.8","4":"0.6011160","5":"24.81350","6":"38812","7":"-125.5721","8":"9.866588"},{"1":"3","2":"2084.875","3":"4.8","4":"0.6193039","5":"15.80134","6":"36448","7":"-146.4304","8":"9.763691"},{"1":"4","2":"1221.895","3":"5.5","4":"0.6098404","5":"31.85611","6":"36909","7":"-120.0302","8":"9.798994"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="topic-model-k-5" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="topic-model-k-5">Topic model: k = 5</h2>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>lda5 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"R_objects/lda_5.rds"</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a>top_terms5 <span class="ot">&lt;-</span> <span class="fu">terms</span>(lda5, <span class="dv">15</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="fu">print</span>(top_terms5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Topic 1     Topic 2   Topic 3   Topic 4  Topic 5    
 [1,] "court"     "school"  "get"     "one"    "action"   
 [2,] "right"     "student" "peopl"   "can"    "black"    
 [3,] "decis"     "colleg"  "year"    "think"  "affirm"   
 [4,] "justic"    "educ"    "work"    "say"    "race"     
 [5,] "law"       "admiss"  "want"    "make"   "white"    
 [6,] "suprem"    "univers" "just"    "like"   "divers"   
 [7,] "rule"      "legaci"  "time"    "point"  "discrimin"
 [8,] "state"     "kid"     "like"    "person" "american" 
 [9,] "case"      "harvard" "good"    "know"   "base"     
[10,] "constitut" "high"    "’s"      "differ" "peopl"    
[11,] "major"     "class"   "countri" "even"   "asian"    
[12,] "thoma"     "public"  "make"    "just"   "minor"    
[13,] "democrat"  "admit"   "now"     "actual" "equal"    
[14,] "govern"    "elit"    "need"    "also"   "racial"   
[15,] "polit"     "applic"  "take"    "best"   "group"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>topicdoc<span class="sc">::</span><span class="fu">topic_diagnostics</span>(<span class="at">topic_model =</span> lda5, <span class="at">dtm_data =</span> dtm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["topic_num"],"name":[1],"type":["int"],"align":["right"]},{"label":["topic_size"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean_token_length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["dist_from_corpus"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["tf_df_dist"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["doc_prominence"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["topic_coherence"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["topic_exclusivity"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1689.7301","3":"5.2","4":"0.6521603","5":"16.04620","6":"17130","7":"-143.9293","8":"9.844830"},{"1":"2","2":"914.4241","3":"5.6","4":"0.6517684","5":"31.52748","6":"16898","7":"-121.9750","8":"9.917625"},{"1":"3","2":"1236.1018","3":"3.8","4":"0.6428925","5":"14.60080","6":"19230","7":"-146.2599","8":"9.469475"},{"1":"4","2":"1205.0437","3":"4.3","4":"0.6393241","5":"11.08762","6":"18728","7":"-154.6756","8":"9.219655"},{"1":"5","2":"938.7003","3":"5.8","4":"0.6391731","5":"24.81350","6":"17337","7":"-125.5721","8":"9.893233"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="topic-model-k-6" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="topic-model-k-6">Topic model: k = 6</h2>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>lda6 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"R_objects/lda_6.rds"</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a>top_terms6 <span class="ot">&lt;-</span> <span class="fu">terms</span>(lda6, <span class="dv">15</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="fu">print</span>(top_terms6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Topic 1   Topic 2    Topic 3   Topic 4     Topic 5     Topic 6 
 [1,] "year"    "school"   "admiss"  "action"    "court"     "just"  
 [2,] "time"    "student"  "get"     "affirm"    "right"     "think" 
 [3,] "peopl"   "colleg"   "legaci"  "race"      "decis"     "like"  
 [4,] "countri" "educ"     "harvard" "black"     "justic"    "make"  
 [5,] "one"     "kid"      "applic"  "white"     "law"       "know"  
 [6,] "work"    "univers"  "admit"   "divers"    "suprem"    "say"   
 [7,] "never"   "high"     "can"     "peopl"     "rule"      "can"   
 [8,] "now"     "need"     "student" "discrimin" "case"      "’s"    
 [9,] "america" "public"   "one"     "asian"     "constitut" "point" 
[10,] "live"    "elit"     "merit"   "american"  "state"     "one"   
[11,] "back"    "famili"   "qualifi" "equal"     "thoma"     "want"  
[12,] "long"    "mani"     "like"    "minor"     "democrat"  "actual"
[13,] "great"   "parent"   "univers" "racial"    "major"     "read"  
[14,] "take"    "graduat"  "colleg"  "base"      "polit"     "thing" 
[15,] "chang"   "children" "best"    "group"     "vote"      "differ"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>topicdoc<span class="sc">::</span><span class="fu">topic_diagnostics</span>(<span class="at">topic_model =</span> lda6, <span class="at">dtm_data =</span> dtm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["topic_num"],"name":[1],"type":["int"],"align":["right"]},{"label":["topic_size"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean_token_length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["dist_from_corpus"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["tf_df_dist"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["doc_prominence"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["topic_coherence"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["topic_exclusivity"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1334.1829","3":"4.6","4":"0.6616589","5":"13.30148","6":"6595","7":"-155.5822","8":"9.386533"},{"1":"2","2":"789.3321","3":"5.1","4":"0.6599802","5":"29.96201","6":"8052","7":"-124.6213","8":"9.786248"},{"1":"3","2":"783.8216","3":"5.1","4":"0.6410220","5":"22.87271","6":"7109","7":"-137.0732","8":"9.707741"},{"1":"4","2":"747.2484","3":"5.9","4":"0.6655375","5":"25.28278","6":"7350","7":"-125.3873","8":"9.861106"},{"1":"5","2":"1395.8571","3":"5.2","4":"0.6754466","5":"16.04620","6":"7951","7":"-139.2849","8":"9.849850"},{"1":"6","2":"933.5580","3":"3.7","4":"0.6683953","5":"11.52105","6":"6702","7":"-150.7432","8":"9.569569"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Jordan Boyd-Graber, David Mimno, and David Newman. Care and Feeding of Topic Models: Problems, Diagnostics, and Improvements. Handbook of Mixed Membership Models and Their Applications, 2014.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>